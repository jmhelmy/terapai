(()=>{var e={};e.id=97,e.ids=[97],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5157:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(s,{Sh:()=>p,U6:()=>d});var o=t(9801),i=t(7879),a=t(14276),n=t(24803),c=e([o,i,a,n]);[o,i,a,n]=c.then?(await c)():c;let l=globalThis;if(console.log("\uD83E\uDEB5 [adminFirebase.ts] Loaded"),console.log("\uD83E\uDEB5 ENV FIRESTORE_EMULATOR_HOST:",process.env.FIRESTORE_EMULATOR_HOST),console.log("\uD83E\uDEB5 ENV FIREBASE_SERVICE_ACCOUNT_KEY present:",!!process.env.FIREBASE_SERVICE_ACCOUNT_KEY),console.log("\uD83E\uDEB5 ENV NEXT_PUBLIC_FIREBASE_PROJECT_ID:","therascript-45b62"),console.log("\uD83E\uDEB5 ENV NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:","therascript-45b62.appspot.com"),console.log("\uD83E\uDEB5 Existing app instance?",!!l._firebaseAdminApp),l._firebaseAdminApp)console.log("\uD83D\uDCE6 Reusing existing Firebase Admin SDK instance");else if(process.env.FIRESTORE_EMULATOR_HOST)console.log("\uD83D\uDD25 Using Firestore emulator at",process.env.FIRESTORE_EMULATOR_HOST),l._firebaseAdminApp=(0,o.initializeApp)({projectId:"therascript-45b62"}),console.log("\uD83D\uDD25 Initialized Admin SDK for emulator");else if(process.env.FIREBASE_SERVICE_ACCOUNT_KEY)try{let e=process.env.FIREBASE_SERVICE_ACCOUNT_KEY;console.log("\uD83D\uDD11 Raw key slice:",e.slice(0,80));let s=JSON.parse(e);console.log("\uD83D\uDD11 Parsed serviceAccount.client_email:",s.client_email),l._firebaseAdminApp=(0,o.initializeApp)({credential:(0,o.cert)(s),storageBucket:"therascript-45b62.appspot.com"}),console.log("✅ Initialized Admin SDK with service account")}catch(e){throw console.error("❌ Failed to parse SERVICE_ACCOUNT_KEY:",e.message,e.stack),Error("Malformed FIREBASE_SERVICE_ACCOUNT_KEY; check escaping and newlines.")}else try{console.log("☁️ Trying default application credentials..."),l._firebaseAdminApp=(0,o.initializeApp)(),console.log("☁️ Initialized Admin SDK with default credentials")}catch(e){throw console.error("❌ Default credentials init failed:",e.message,e.stack),Error("Firebase Admin SDK initialization failed: no credentials found.")}let p=(0,i.getFirestore)(l._firebaseAdminApp),d=(0,a.getAuth)(l._firebaseAdminApp);(0,n.getStorage)(l._firebaseAdminApp),r()}catch(e){r(e)}})},7879:e=>{"use strict";e.exports=import("firebase-admin/firestore")},9801:e=>{"use strict";e.exports=import("firebase-admin/app")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14276:e=>{"use strict";e.exports=import("firebase-admin/auth")},24803:e=>{"use strict";e.exports=import("firebase-admin/storage")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63388:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{patchFetch:()=>l,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>u});var o=t(96559),i=t(48088),a=t(37719),n=t(99817),c=e([n]);n=(c.then?(await c)():c)[0];let p=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:"app/api/sessions/route"},resolvedPagePath:"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/api/sessions/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:u,serverHooks:g}=p;function l(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:u})}r()}catch(e){r(e)}})},78335:()=>{},96487:()=>{},99817:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{GET:()=>n,dynamic:()=>l,runtime:()=>c});var o=t(32190),i=t(5157),a=e([i]);i=(a.then?(await a)():a)[0];let c="nodejs",l="force-dynamic";async function n(e){console.log("\uD83D\uDFE2 [API] /api/sessions GET called");try{let s,t,r=e.headers.get("Authorization");if(console.log("\uD83D\uDD0E Auth header:",r),!r?.startsWith("Bearer "))return console.warn("⛔ Missing or invalid Authorization header"),o.NextResponse.json({error:"Unauthorized"},{status:401});let a=r.split("Bearer ")[1];console.log("\uD83D\uDD11 idToken present:",!!a);try{s=await i.U6.verifyIdToken(a),console.log("✅ Decoded token:",s&&s.uid)}catch(e){return console.error("⛔ verifyIdToken error:",e.message,e.stack),o.NextResponse.json({error:"Invalid token: "+e.message},{status:401})}let n=s?.uid;if(console.log("\uD83E\uDDD1 userId:",n),!n)return console.warn("⛔ Invalid token payload"),o.NextResponse.json({error:"Invalid token payload"},{status:401});let c=i.Sh.collection("therapySessionNotes").where("therapistId","==",n);try{console.log("\uD83D\uDCE5 Attempting orderBy(createdAt)..."),t=await c.orderBy("createdAt","desc").get(),console.log("\uD83D\uDCE6 orderBy succeeded, docs:",t.docs.length)}catch(e){console.warn("⚠️ orderBy(createdAt) failed:",e.message),t=await c.get(),console.log("\uD83D\uDCE6 Unsorted fetch succeeded, docs:",t.docs.length)}let l=t.docs.map(e=>{let s=e.data();return{id:e.id,clientInitials:s.clientInitials??"—",sessionDate:s.createdAt?.toDate?.().toISOString()??"",transcript:s.transcript??"",soapNote:{subjective:s.soapNote?.subjective??"",objective:s.soapNote?.objective??"",assessment:s.soapNote?.assessment??"",plan:s.soapNote?.plan??""}}});return console.log("✅ Sessions mapped:",l.length),o.NextResponse.json(l)}catch(e){return console.error("\uD83D\uDFE5 GET /api/sessions error:",e.message,"\n",e.stack),o.NextResponse.json({error:e.message},{status:500})}}r()}catch(e){r(e)}})}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[719,580],()=>t(63388));module.exports=r})();