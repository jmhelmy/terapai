(()=>{var e={};e.id=323,e.ids=[323],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3881:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>A});var s=t(60687),o=t(43210),n=t(16189),a=t(85814),i=t.n(a),l=t(18780),c=t(27686),d=t.n(c);function u({message:e,baseClass:r,successClass:t,errorClass:o}){if(!e)return null;let n=e.toLowerCase().includes("error")||e.toLowerCase().includes("failed"),a=r||d().container,i=n?o||d().error:t||d().success;return(0,s.jsx)("div",{className:`${a} ${i}`,role:"status",children:e})}var p=t(83452),m=t.n(p);function h({progress:e}){return e<=0?null:(0,s.jsx)("div",{className:m().container,children:(0,s.jsx)("div",{className:m().filler,style:{width:`${e}%`}})})}var g=t(70571),v=t.n(g);function f({variant:e="primary",className:r="",...t}){let o="primary"===e?v().primary:v().secondary;return(0,s.jsx)("button",{className:`${v().base} ${o} ${r}`,...t})}let x=()=>{let[e,r]=(0,o.useState)(!1),[t,s]=(0,o.useState)(0),[n,a]=(0,o.useState)(null),[i,l]=(0,o.useState)(""),[c,d]=(0,o.useState)(null),[u,p]=(0,o.useState)(null),m=(0,o.useRef)(null),h=(0,o.useRef)([]),g=(0,o.useRef)(null),v=(0,o.useRef)(null),f=(0,o.useCallback)(()=>{v.current?.getTracks().forEach(e=>e.stop()),v.current=null,g.current&&(clearInterval(g.current),g.current=null)},[]);(0,o.useEffect)(()=>()=>f(),[f]);let x=async()=>{if(!e){a(null),p(null),l("Requesting mic…");try{v.current=await navigator.mediaDevices.getUserMedia({audio:!0}),l("Recording…"),d(Date.now()),s(0);let e=new MediaRecorder(v.current);m.current=e,h.current=[],e.ondataavailable=e=>{e.data.size>0&&h.current.push(e.data)},e.onstop=()=>{let t=new Blob(h.current,{type:e.mimeType});a(t),r(!1),l("Stopped"),p(Date.now()),f()},e.start(),r(!0),g.current=setInterval(()=>{s(e=>e+1)},1e3)}catch(e){l("Mic error: "+(e.message||e.name)),f()}}};return{isRecording:e,recordingDuration:t,audioBlob:n,statusMessage:i,setStatusMessage:l,startTime:c,endTime:u,startRecording:x,stopRecording:()=>{m.current?.state==="recording"&&m.current.stop()}}};var P=t(64583),_=t(75535);async function b(e,r,t,s,o,n){let a={therapistId:e,createdAt:(0,_.O5)(),sessionDate:_.Dc.fromDate(s),transcript:r,soapNote:t,structuredContent:"",originalAudioFileName:o,status:"complete",sessionId:n};console.log("▶️ About to write therapySessionNote:",{therapistId:a.therapistId,transcript:a.transcript,sessionDate:a.sessionDate,createdAt:a.createdAt,originalAudioFileName:a.originalAudioFileName,status:a.status,sessionId:a.sessionId});try{let e=(0,_.H9)((0,_.rJ)(P.k,"therapySessionNotes"));return await (0,_.BN)(e,a),console.log("✅ Therapy session note saved with ID:",e.id),e.id}catch(e){throw console.error("❌ Error saving therapy session note to Firestore:",e),Error("Failed to save therapy note. Please try again.")}}let y=()=>{let[e,r]=(0,o.useState)(!1),[t,s]=(0,o.useState)(0),[n,a]=(0,o.useState)("");return{isProcessing:e,uploadProgress:t,statusMessage:n,processAudio:async(e,t,o,n)=>{if(!e){let e="Processing failed: audioBlob is missing.";console.error(e),a(e),n?.(!1,void 0,null,e);return}if(!o){let e="Processing failed: sessionId is missing or invalid.";console.error(e),a(e),n?.(!1,void 0,null,e);return}r(!0),s(0),a("Sending audio to transcriber…");try{let r="session-audio.mp3",i=new File([e],r,{type:e.type});console.log("\uD83D\uDCE4 Uploading to Whisper with file.name:",i.name),s(10);let l=new FormData;l.append("file",i);let c=process.env.NEXT_PUBLIC_WHISPER_API_URL;if(!c)throw Error("Whisper API URL is not defined in environment variables.");let d=await fetch(`${c}/transcribe`,{method:"POST",body:l});if(!d.ok){let e=await d.text();throw Error(`Transcription error: ${d.status} - ${e}`)}let u=(await d.json()).text;console.log("✅ Whisper transcript:",u),a("Transcript received. Sending to OpenAI…"),s(40);let p=await fetch("/api/generate-soap-note",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:u})});if(!p.ok){let e=await p.text();throw Error(`SOAP note generation error: ${p.status} - ${e}`)}let m=(await p.json()).soapNote;console.log("✅ Received SOAP note:",m),a("Saving transcript and SOAP note…"),s(70);let h=i.name??r;console.log("▶️ Final originalAudioFileName to write:",h);let g=await b(t,u,m,new Date,h,o);console.log("✅ Therapy session note saved with ID:",g),a("Saved successfully."),s(100),n?.(!0,{transcript:u,soapNote:m},g)}catch(r){let e=`Processing failed: ${r.message}`;console.error(e),a(e),n?.(!1,void 0,null,e)}finally{r(!1),s(100)}},setStatusMessage:a}};var S=t(67747),j=t.n(S);function w(e){let r=Math.floor(e/60),t=Math.floor(e%60);return`${r}:${String(t).padStart(2,"0")}`}function A(){return(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(R,{})})}function R(){(0,n.useRouter)();let e=(0,n.useSearchParams)(),[r]=(0,o.useState)(()=>{let r=e.get("sessionId");return r&&r.length>0?r:function(e=16){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let s=0;s<e;s++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}(24)}),{user:t,loading:a}=(0,l.A)(),[c,d]=(0,o.useState)(!1),[p,m]=(0,o.useState)(null),[g,v]=(0,o.useState)(null),[P,_]=(0,o.useState)(!1),{isRecording:b,recordingDuration:S,audioBlob:A,startRecording:R,stopRecording:k,statusMessage:D,setStatusMessage:C}=x(),{isProcessing:N,uploadProgress:I,processAudio:q,statusMessage:B}=y();return a?(0,s.jsx)("div",{className:j().pageWrapper,children:(0,s.jsx)("div",{className:j().card,children:(0,s.jsx)("p",{children:"Loading authentication…"})})}):t?(0,s.jsx)("div",{className:j().pageWrapper,children:(0,s.jsxs)("div",{className:j().card,children:[(0,s.jsxs)("div",{className:j().headerRow,children:[(0,s.jsx)(i(),{href:"/dashboard",className:j().backLink,children:"← Dashboard"}),(0,s.jsx)("h1",{className:j().pageTitle,children:"Record New Session"})]}),(0,s.jsx)(u,{message:b?`Recording… (${w(S)})`:B||D,baseClass:j().statusMessage,successClass:j().statusSuccess,errorClass:j().statusError}),!c&&(0,s.jsx)("p",{className:j().disclaimer,children:"By proceeding to record, you confirm you've obtained patient consent."}),(0,s.jsxs)("div",{className:j().controlsWrapper,children:[!b&&!c&&(0,s.jsx)(f,{variant:"primary",onClick:()=>{d(!0),m(new Date),_(!1),R()},children:"Start Recording"}),b&&(0,s.jsx)(f,{variant:"secondary",onClick:()=>{k(),v(new Date)},children:"Stop Recording"})]}),c&&g&&(0,s.jsxs)("div",{className:j().timeline,children:[p?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"\xa0–\xa0",g?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"\xa0(Duration ",w(S),")"]}),N&&(0,s.jsx)(h,{progress:I})]})}):(0,s.jsx)("div",{className:j().pageWrapper,children:(0,s.jsx)("div",{className:j().card,children:(0,s.jsx)("p",{children:"Verifying session or redirecting..."})})})}},6034:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>a.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=t(65239),o=t(48088),n=t(88170),a=t.n(n),i=t(30893),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);t.d(r,l);let c={children:["",{children:["session",{children:["record",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,47039)),"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/session/record/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,94431)),"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,54413)),"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/session/record/page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/session/record/page",pathname:"/session/record",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12554:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>o});var s=t(12907);let o=(0,s.registerClientReference)(function(){throw Error("Attempted to call AuthProvider() from the server but AuthProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/context/AuthContext.tsx","AuthProvider");(0,s.registerClientReference)(function(){throw Error("Attempted to call useAuth() from the server but useAuth is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/context/AuthContext.tsx","useAuth")},13063:(e,r,t)=>{Promise.resolve().then(t.bind(t,12554))},15944:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,86346,23)),Promise.resolve().then(t.t.bind(t,27924,23)),Promise.resolve().then(t.t.bind(t,35656,23)),Promise.resolve().then(t.t.bind(t,40099,23)),Promise.resolve().then(t.t.bind(t,38243,23)),Promise.resolve().then(t.t.bind(t,28827,23)),Promise.resolve().then(t.t.bind(t,62763,23)),Promise.resolve().then(t.t.bind(t,97173,23))},16189:(e,r,t)=>{"use strict";var s=t(65773);t.o(s,"notFound")&&t.d(r,{notFound:function(){return s.notFound}}),t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},18204:(e,r,t)=>{Promise.resolve().then(t.bind(t,47039))},18780:(e,r,t)=>{"use strict";t.d(r,{A:()=>l,AuthProvider:()=>i});var s=t(60687),o=t(43210),n=t(64583);let a=(0,o.createContext)(void 0),i=({children:e})=>{let[r,t]=(0,o.useState)(null),[i,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=n.j.onAuthStateChanged(e=>{t(e),l(!1)});return()=>e()},[]);let c=async()=>{await n.j.signOut()};return(0,s.jsx)(a.Provider,{value:{user:r,loading:i,signOut:c},children:e})},l=()=>{let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27686:e=>{e.exports={container:"StatusBanner_container__VNHBU",success:"StatusBanner_success__6simE",error:"StatusBanner_error__axQ0U"}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29096:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,16444,23)),Promise.resolve().then(t.t.bind(t,16042,23)),Promise.resolve().then(t.t.bind(t,88170,23)),Promise.resolve().then(t.t.bind(t,49477,23)),Promise.resolve().then(t.t.bind(t,29345,23)),Promise.resolve().then(t.t.bind(t,12089,23)),Promise.resolve().then(t.t.bind(t,46577,23)),Promise.resolve().then(t.t.bind(t,31307,23))},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37366:e=>{"use strict";e.exports=require("dns")},42354:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,4536,23))},47039:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/session/record/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/johnhelmy/Desktop/Programming/terapai/my-app/src/app/session/record/page.tsx","default")},52383:(e,r,t)=>{Promise.resolve().then(t.bind(t,18780))},54413:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});var s=t(37413),o=t(4536),n=t.n(o);function a(){return(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"calc(100vh - 100px)",textAlign:"center",fontFamily:"sans-serif",padding:"20px",color:"#334155"},children:[(0,s.jsx)("h1",{style:{fontSize:"clamp(3rem, 10vw, 6rem)",fontWeight:700,color:"#009DA3",margin:"0 0 0.5rem 0"},children:"404"}),(0,s.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:600,marginBottom:"1rem"},children:"Page Not Found"}),(0,s.jsx)("p",{style:{fontSize:"1.125rem",marginBottom:"2rem",maxWidth:"400px",color:"#475569"},children:"Oops! It seems the page you’re looking for doesn’t exist or has been moved."}),(0,s.jsx)(n(),{href:"/",style:{display:"inline-block",padding:"0.75rem 1.5rem",fontSize:"1rem",fontWeight:500,color:"white",backgroundColor:"#009DA3",borderRadius:"0.375rem",textDecoration:"none",transition:"opacity 0.2s ease-in-out"},children:"Go Back Home"})]})}},55511:e=>{"use strict";e.exports=require("crypto")},61135:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64583:(e,r,t)=>{"use strict";t.d(r,{j:()=>l,k:()=>c});var s=t(67989),o=t(78403),n=t(75535);let a={apiKey:"AIzaSyB8XOlU5pDZV0FWvnRLk3520uYEgwbVmac",authDomain:"therascript-45b62.firebaseapp.com",projectId:"therascript-45b62",storageBucket:"therascript-45b62.appspot.com",messagingSenderId:"64757237031",appId:"1:64757237031:web:c541b0cf649c0d88fb5502"};console.log("\uD83D\uDD25 Firebase config being used:",a);let i=(0,s.Dk)().length?(0,s.Dk)()[0]:(0,s.Wp)(a),l=(0,o.getAuth)(i),c=(0,n.aU)(i)},67747:e=>{e.exports={pageWrapper:"RecordSessionPage_pageWrapper__JylSU",card:"RecordSessionPage_card__K0TSD",headerRow:"RecordSessionPage_headerRow__stdyF",pageTitle:"RecordSessionPage_pageTitle__BkjSz",backLink:"RecordSessionPage_backLink__a53w9",statusMessage:"RecordSessionPage_statusMessage__Y0Cha",statusSuccess:"RecordSessionPage_statusSuccess__39yDC",statusError:"RecordSessionPage_statusError__11427",disclaimer:"RecordSessionPage_disclaimer__Am4vg",fadeIn:"RecordSessionPage_fadeIn__TbAyn",controlsWrapper:"RecordSessionPage_controlsWrapper__x9nv_",hidden:"RecordSessionPage_hidden__4gk0a",base:"RecordSessionPage_base__NdRmD",recordingBadge:"RecordSessionPage_recordingBadge__MMdIY",pulse:"RecordSessionPage_pulse__bJtGQ",timeline:"RecordSessionPage_timeline__csz0X",progressBar:"RecordSessionPage_progressBar__IMsXD",progress:"RecordSessionPage_progress__HqSTP"}},70440:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>o});var s=t(31658);let o=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},70571:e=>{e.exports={base:"Button_base__GoPte",primary:"Button_primary__NvDjW",secondary:"Button_secondary__PNkAv"}},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},76348:(e,r,t)=>{Promise.resolve().then(t.bind(t,3881))},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83452:e=>{e.exports={container:"ProgressBar_container__ZeYDS",filler:"ProgressBar_filler__TfPDP"}},89210:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,85814,23))},91645:e=>{"use strict";e.exports=require("net")},94431:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l,metadata:()=>i});var s=t(37413),o=t(14893),n=t.n(o);t(61135);var a=t(12554);let i={title:"Terapai",description:"HIPAA-compliant AI note assistant for therapists",icons:{icon:"/couchicon2.png"}};function l({children:e}){return(0,s.jsx)("html",{lang:"en",className:`${n().variable} ${n().className}`,children:(0,s.jsx)("body",{children:(0,s.jsx)(a.AuthProvider,{children:e})})})}},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[719,373],()=>t(6034));module.exports=s})();